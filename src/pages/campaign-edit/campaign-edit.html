<template>
  <main>
    <section class="banner mini">
      <div class="container">
        <div class="bannertext">
          <div class="line">
            <div class="lbl"> <span t="dashboard:editCampaign" class="text-uppercase"></span></div>
            <div class="wrap"><span>${campaign.title ? campaign.title : campaign.username}</span></div>
          </div>
        </div>
        <nav class="vertical">
          <ul>
            <li><a route-href="route: dashboard; params.bind: { lang: loc, resource: 'campaigns' }" t="[prepend]dashboard:returnDashboard">
              <img src="/img/ic-arrow-right-black.png">
            </a></li>
          </ul>
        </nav>
        <div class="bgwrap" style="background-image: url('/img/assets/img/content/background-space.png');"></div>
      </div>
    </section>
    <div role="main">
      <div class="container pe-0">
        <section class="entrance campaign-edit">
          <div class="section-body campaignEditor">
            <div class="d-flex justify-content-between button-group mb-5">
              <div class="toggleWrapper">
                <label class="mb-0 me-4" t="[prepend]dashboard:visibility">:</label>
                <input type="checkbox" name="toggle1" class="mobileToggle" id="toggle1" checked.bind="campaign.isPublic">
                <label class="mb-0" for="toggle1"></label>
                <span class="ms-2">${campaign.isPublic ? i18n.tr('app:public') : i18n.tr('app:private')}</span>
              </div>
              <div>
                <button t="app:preview" class="m-0 btn-green" click.delegate="previewCampaign()"></button>
                <button t="app:delete" class="btn-red m-0 me-3" click.delegate="deleteCampaign()"></button>
              </div>
            </div>
            <div class="topsection mb-3">
              <div class="sectionlabel">
                <div class="bold">
                  <strong class="text-uppercase me-2" t="dashboard:campaignDetails"></strong>
                </div>
              </div>
              <div class="import-wrap">
                <section class="languages">
                  <div class="lang-collection lang-campEditor">
                    <label class="languageSelectorLabel m-0 pb-1 pe-4" t="[prepend]dashboard:inputLanguage">:</label>
                    <a id="langselect" class="me-0" href="javascript:void(0)" click.delegate="toggleLangMenu()" data-toggle="dropdown">
                      <span class="flag me-2"><img class="pb-2" src=${currentLocale.flag} /></span>
                      <span class="font-size-bigger me-1">${currentLocale.title}</span>
                      <span><img src="/img/ic-arrow-down-black.png"></span>
                    </a>
                    <ul aria-labelledby="langselect" class="dropdown-menu">
                      <li repeat.for="locale of locales">
                        <a href="javascript:void(0)" click.delegate="changeLang($index)">
                          <img src=${locale.flag} width="16px" />
                          <span css="font-weight: ${locale.code === currentLocale.code ? 'bold' : 'normal'}">${locale.title}</span>
                        </a>
                      </li>
                    </ul>
                  </div>
                </section>
              </div>
            </div>
            <form role="form">
              <div class="input-group">
                <div class="center">
                  <label t="dashboard:shortName">Username</label>
                  <input t="[placeholder]dashboard:username" type="text" placeholder="Username" id="username"
                    value.bind="campaign.username" autofocus />
                  <span class="help-block has-error" if.bind="errors.email">${errors.email}</span>
                </div>
                <div class="left">
                  <label t="dashboard:startDate">Start Date</label>
                  <input t="[placeholder]dashboard:startDate" type="date" placeholder="Start Date" id="startDate"
                    value.bind="campaign.startDate" autofocus />
                </div>
                <div class="right">
                  <label t="dashboard:endDate">End Date</label>
                  <input t="[placeholder]dashboard:endDate" type="date" placeholder="End Date" id="endDate"
                    value.bind="campaign.endDate" autofocus />
                </div>
                <div class="center">
                  <label t="dashboard:banner">Banner</label>
                  <div class="banner-edit center">
                    <img src="${campaign.banner.replace('?file=true','')}" alt="${username+'-'+banner}" width="100%">
                    <ul class="itemaction">
                      <li if.bind="campaign.banner != DEFAULT_BANNER" class="btn-delete-collection me-0" click.delegate="removeBanner()">
                        <a data-toggle="tooltip" data-placement="top" class="delete">
                          <img class="editicon"src="/img/assets/img/ui/ic-delete.png" />
                        </a>
                      </li>
                      <li class="btn-edit-collection" click.delegate="loadFromFile('#bannerFile')">
                        <a data-toggle="tooltip" data-placement="top">
                          <img class="editicon" src="/img/assets/img/ui/ic-edit.png" />
                        </a>
                      </li>
      							</ul>
                  </div>
                  <input type="file" id="bannerFile" class="hiddenfile" name="banner" onchange.bind="uploadBanner" accept=".png,.jpg,.jpeg,.gif" />
                </div>
                <div class="center">
                  <label t="dashboard:title">Title</label>
                  <input t="[placeholder]dashboard:title" type="text" placeholder="Title" id="title"
                    value.bind="campaign.titleObject[currentLocale.code]" autofocus />
                </div>
                <div class="center">
                  <label t="dashboard:description">Description</label>
                  <textarea t="[placeholder]dashboard:description" rows="4" placeholder="Description"
                    id="description" value.bind="campaign.descriptionObject[currentLocale.code]" autofocus>
                  </textarea>
                </div>
                <div class="d-flex">
                  <div class="w-30 me-3">
                    <label t="dashboard:logo">Logo</label>
                    <div class="logo-edit center">
                      <img if.bind="campaign.logo" src="${campaign.logo.replace('?file=true','')}" alt="${username+'-'+logo}" width="100%">
                      <ul class="itemaction">
                        <li if.bind="campaign.logo" class="btn-delete-collection me-0" click.delegate="removeLogo()">
                          <a data-toggle="tooltip" data-placement="top" class="delete">
                            <img class="editicon"src="/img/assets/img/ui/ic-delete.png" />
                          </a>
                        </li>
                        <li class="btn-edit-collection" click.delegate="loadFromFile('#logoFile')">
                          <a data-toggle="tooltip" data-placement="top">
                            <img class="editicon" src="/img/assets/img/ui/ic-edit.png" />
                          </a>
                        </li>
        							</ul>
                    </div>
                    <input type="file" id="logoFile" class="hiddenfile" name="logo" onchange.bind="uploadLogo" accept=".png,.jpg,.jpeg,.gif" />
                  </div>
                  <div class="w-70">
                    <label t="dashboard:disclaimer">Disclaimer</label>
                    <textarea class="disclaimerTextarea" t="[placeholder]dashboard:disclaimer" rows="4" placeholder="Disclaimer" id="disclaimer"
                      value.bind="campaign.disclaimerObject[currentLocale.code]" autofocus>
                    </textarea>
                  </div>
                </div>
                <div class="center">
                  <div repeat.for="prize of prizes" class="mb-3">
                    <label t="dashboard:${prize}">${prize}</label>
                    <input t="[placeholder]dashboard:${prize}" type="text" placeholder="${prize}" id="${prize}"
                      value.bind="campaign.prizesObject[prize][currentLocale.code]" autofocus />
                  </div>
                </div>
              </div>
              <div class="topsection mt-5 mb-3">
                <div class="sectionlabel">
                  <div class="bold">
                    <strong class="text-uppercase me-2" t="dashboard:campaignAnnotating"></strong>
                  </div>
                </div>
              </div>
              <div class="input-group">
                <div class="center">
                  <label t="dashboard:annotationTarget">Annotation target (number of contributions)</label>
                  <input t="[placeholder]dashboard:target" type="number" id="annotationTarget" value.bind="campaign.target" class="w-100 p-4" />
                </div>
                <div class="center">
                  <label t="dashboard:instructions">Instructions</label>
                  <textarea t="[placeholder]dashboard:instructions" rows="4" placeholder="Instructions"
                    id="instructions" value.bind="campaign.instructionsObject[currentLocale.code]" autofocus>
                  </textarea>
                </div>
                <div class="center">
                  <label t="dashboard:campaignMotivations">Campaign motivations</label>
                  <div class="motivations d-flex">
                    <div class="me-5" repeat.for="mot of motivations">
                      <input class="form-check-input" type="checkbox" id.bind="`mot-${$index}`" checked.bind="motivationValues[mot]">
                      <span class="form-check-label" for.bind="`mot-${$index}`">${mot}</span>
                    </div>
                  </div>
                </div>
                <div class="center">
                  <label t="dashboard:vocabularies">Vocabularies</label>
                  <ul class="tagPills">
                    <li repeat.for="voc of selectedVocabularies">
                      <i class="fa fa-book me-1" aria-hidden="true"></i>
                      <span class="me-2">${voc}</span>
                      <a click.delegate="removeVocabulary(voc)"><i class="delete fa fa-times" aria-hidden="true"></i></a>
                    </li>
                  </ul>
                  <select name="vocabularies" id="vocabulariesSelector" disabled.bind="!motivationValues.Tagging" change.delegate="addVocabulary($event.target.value)">
                    <option value="" disabled selected t="dashboard:vocabulariesPlaceholder"></option>
                    <option repeat.for="voc of availableVocabularies" value.bind="voc.name">${voc.label}</option>
                  </select>
                </div>
              </div>
              <div class="topsection mt-5 mb-3">
                <div class="sectionlabel">
                  <div class="bold">
                    <strong class="text-uppercase me-2" t="dashboard:campaignAccess"></strong>
                  </div>
                </div>
              </div>
              <div class="input-group">
                <div class=" center autocomplete-container">
                  <label t="dashboard:campaignModerators">Campaign moderators</label>
                  <ul class="tagPills">
                    <li repeat.for="mod of moderators">
                      <i class="fa fa-user-o me-1" aria-hidden="true"></i>
                      <span class="me-2">${mod.name}</span>
                      <a if.bind="user.username != mod.name" click.delegate="removeMember(mod.id)"><i class="delete fa fa-times" aria-hidden="true"></i></a>
                      <i if.bind="user.username == mod.name" class="fa fa-lock" aria-hidden="true"></i>
                    </li>
                  </ul>
                  <input id="uinput" autocomplete="off" value.bind="prefix" input.delegate="prefixChanged($event.target.value)"
                    type="text" placeholder.bind="i18n.tr('dashboard:addUserPlaceholder')" />
                  <div id="usersuggestions" show.bind='suggestionsActive' class="autocomplete-suggestions">
                    <div id="u${$index}" class="autocomplete-suggestion autocomplete-suggestion-extra"
                      mouseover.delegate="domouseover('u'+$index)" mouseout.delegate="domouseout('u'+$index)"
                      click.delegate="addMember($index)" repeat.for="item of suggestedNames">
                      ${item.value}
                      <!-- <span class="label pull-right" style="color: black">${item.data.category}</span> -->
                    </div>
                  </div>
                </div>
                <div class="center">
                  <label t="dashboard:campaignUsergroups">Campaign usergroups</label>
                  <input t="[placeholder]dashboard:username" type="text" placeholder="Username" id="username"
                    value.bind="campaign.username" autofocus />
                  <span class="help-block has-error" if.bind="errors.email">${errors.email}</span>
                </div>
              </div>
              <div class="d-flex justify-content-between button-group mt-5">
                <button t="dashboard:cancel" class="m-0 btn-red" click.delegate="goBackToDashboard()"></button>
                <button t="app:update" class="m-0 btn-green" click.delegate="updateCampaign()"></button>
              </div>
            </form>
          </div>
        </section>
      </div>
    </div>
  </main>
</template>
